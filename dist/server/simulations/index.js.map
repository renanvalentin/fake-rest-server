{"version":3,"sources":["../../../server/simulations/index.js"],"names":["create","setup","simulations","templates","map","template","resolved","variables","req","res","next","simulate","undefined","url","match","route","timeout","setTimeout"],"mappings":";;;;;;;;;AAEA;;;;AAEA;;;;AAGO,MAAMA,0BAAUC,KAAD,IAAkB;AACtC,QAAMC,cAAcD,MAAME,SAAN,CAAgBC,GAAhB,CAAqBC,QAAD,IAAc;AACpD,UAAMC,WAAW,4BAAgBD,QAAhB,eAA+BJ,MAAMM,SAArC,EAAmDF,SAASE,SAA5D,EAAjB;;AAEA,WAAO,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACzB,YAAM,EAAEC,QAAF,KAAeL,QAArB;;AAEA,UAAIK,aAAaC,SAAjB,EAA4B;AAC1B,eAAOF,MAAP;AACD;;AAED,UAAIF,IAAIK,GAAJ,CAAQC,KAAR,CAAcR,SAASS,KAAvB,CAAJ,EAAmC;AACjC,YAAIJ,SAASK,OAAT,KAAqBJ,SAAzB,EAAoC;AAClC,iBAAOK,WAAW,MAAMP,MAAjB,EAAyBC,SAASK,OAAlC,CAAP;AACD;AACF;;AAED,aAAON,MAAP;AACD,KAdD;AAeD,GAlBmB,CAApB;;AAoBA,SAAOR,WAAP;AACD,CAtBM","file":"index.js","sourcesContent":["/* @flow */\n\nimport _ from 'lodash';\n\nimport { resolveTemplate } from '../utils';\nimport type { Setup } from '../types';\n\nexport const create = (setup: Setup) => {\n  const simulations = setup.templates.map((template) => {\n    const resolved = resolveTemplate(template, { ...setup.variables, ...template.variables });\n\n    return (req, res, next) => {\n      const { simulate } = resolved;\n\n      if (simulate === undefined) {\n        return next();\n      }\n\n      if (req.url.match(resolved.route)) {\n        if (simulate.timeout !== undefined) {\n          return setTimeout(() => next(), simulate.timeout);\n        }\n      }\n\n      return next();\n    };\n  });\n\n  return simulations;\n};\n"]}