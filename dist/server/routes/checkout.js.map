{"version":3,"sources":["../../../server/routes/checkout.js"],"names":["logger","checkoutHandler","req","res","returnURLRequest","sessionID","params","ztoken","query","sessionFromWebUIIDRequest","returnURL","session","Promise","all","render","err","error","status"],"mappings":";;;;;;AAIA;;AACA;;AACA;;;;AAEA,MAAMA,SAAS,kBAAI,iBAAJ,CAAf;;AAEA,MAAMC;AAAA,+BAAkB,WAAOC,GAAP,EAAsBC,GAAtB,EAAyC;AAC/D,QAAI;AACF,YAAMC,mBAAmB,sCAAa,EAAEC,WAAWH,IAAII,MAAJ,CAAWD,SAAxB,EAAb,CAAzB;;AAEA;AACA,YAAM,EAAEE,MAAF,KAAkCL,IAAIM,KAA5C;;AAEA,YAAMC,4BAA4B,yCAAmBP,IAAII,MAAJ,CAAWD,SAA9B,EAAyCE,MAAzC,CAAlC;;AAEA,YAAM,CAACG,SAAD,EAAYC,OAAZ,IAAuB,MAAMC,QAAQC,GAAR,CAAY,CAACT,gBAAD,EAAmBK,yBAAnB,CAAZ,CAAnC;;AAEAN,UAAIW,MAAJ,CAAW,OAAX,EAAoB,EAAEJ,SAAF,EAAaC,OAAb,EAApB;AACD,KAXD,CAWE,OAAOI,GAAP,EAAY;AACZf,aAAOgB,KAAP,CAAaD,GAAb;;AAEAZ,UAAIc,MAAJ,CAAW,GAAX;AACAd,UAAIW,MAAJ,CAAW,eAAX;AACD;AACF,GAlBK;;AAAA;AAAA;AAAA;AAAA,IAAN;;kBAoBeb,e","file":"checkout.js","sourcesContent":["/* @flow */\n\nimport type { $Request, $Response } from 'express';\n\nimport { sessionFromWebUIID } from '../purchaseService';\nimport { getReturnURL } from '../merchant/templateParameters';\nimport { log } from '../utils/logging';\n\nconst logger = log('checkoutHandler');\n\nconst checkoutHandler = async (req: $Request, res: $Response) => {\n  try {\n    const returnURLRequest = getReturnURL({ sessionID: req.params.sessionID });\n\n    // $FlowFixMe: https://github.com/flowtype/flow-typed/pull/1275\n    const { ztoken }: { ztoken?: string } = req.query;\n\n    const sessionFromWebUIIDRequest = sessionFromWebUIID(req.params.sessionID, ztoken);\n\n    const [returnURL, session] = await Promise.all([returnURLRequest, sessionFromWebUIIDRequest]);\n\n    res.render('index', { returnURL, session });\n  } catch (err) {\n    logger.error(err);\n\n    res.status(500);\n    res.render('internalError');\n  }\n};\n\nexport default checkoutHandler;\n"]}