{"version":3,"sources":["../server/app.js"],"names":["info","createApp","setup","app","config","loglevel","use","options","bodyParser","json","resolvedSetup","forEach","validation","routes","routeNotFoundHandler","errorHandler","startApp","listen","port"],"mappings":";;;;;;;AAEA;;;;AACA;;;;AAEA;;;;AACA;;;;AAEA;;;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;AAIA,MAAM,EAAEA,IAAF,KAAW,gBAAI,KAAJ,CAAjB;;AAEO,MAAMC;AAAA,+BAAY,WAAOC,KAAP,EAAwB;AAC/C,UAAMC,MAAM,wBAAZ;;AAEA,4BAAYC,iBAAOC,QAAnB;;AAEAF,QAAIG,GAAJ,CAAQ,8BAAkBF,iBAAOC,QAAzB,CAAR;AACAF,QAAIG,GAAJ,CAAQ,4BAAR;;AAEAH,QAAII,OAAJ,CAAY,GAAZ,EAAiB,qBAAjB;AACAJ,QAAIG,GAAJ,CAAQ,qBAAR;;AAEAH,QAAIG,GAAJ,CAAQE,qBAAWC,IAAX,EAAR;;AAEA,UAAMC,gBAAgB,MAAM,wBAAQR,KAAR,CAA5B;;AAEA,6BAAkBQ,aAAlB,EAAiCC,OAAjC,CAAyC;AAAA,aAAcR,IAAIG,GAAJ,CAAQM,UAAR,CAAd;AAAA,KAAzC;AACA,6BAAkBF,aAAlB,EAAiCC,OAAjC,CAAyC;AAAA,aAAcR,IAAIG,GAAJ,CAAQM,UAAR,CAAd;AAAA,KAAzC;;AAEA,UAAMC,SAAS,MAAM,oBAAaH,aAAb,CAArB;;AAEAP,QAAIG,GAAJ,CAAQO,MAAR;;AAEAV,QAAIG,GAAJ,CAAQQ,2BAAR;AACAX,QAAIG,GAAJ,CAAQS,mBAAR;;AAEA,WAAOZ,GAAP;AACD,GA1BY;;AAAA;AAAA;AAAA;AAAA,IAAN;;AA4BA,MAAMa,8BAAYb,GAAD,IACtBA,IAAIc,MAAJ,CAAWb,iBAAOc,IAAlB,EAAwB,MAAM;AAC5BlB,OAAM,qCAAoCI,iBAAOc,IAAK,EAAtD;AACD,CAFD,CADK","file":"app.js","sourcesContent":["/* @flow */\n\nimport compression from 'compression';\nimport express from 'express';\nimport type { $Application } from 'express';\nimport cors from 'cors';\nimport bodyParser from 'body-parser';\n\nimport config from './config';\nimport { resolve } from './templates';\nimport { create as createRoutes } from './routes';\nimport { create as createValidations } from './validations';\nimport { create as createSimulations } from './simulations';\nimport { log, loggingMiddleware, setloglevel, routeNotFoundHandler, errorHandler } from './utils';\n\nimport type { Setup } from './types';\n\nconst { info } = log('app');\n\nexport const createApp = async (setup: Setup) => {\n  const app = express();\n\n  setloglevel(config.loglevel);\n\n  app.use(loggingMiddleware(config.loglevel));\n  app.use(compression());\n\n  app.options('*', cors());\n  app.use(cors());\n\n  app.use(bodyParser.json());\n\n  const resolvedSetup = await resolve(setup);\n\n  createValidations(resolvedSetup).forEach(validation => app.use(validation));\n  createSimulations(resolvedSetup).forEach(validation => app.use(validation));\n\n  const routes = await createRoutes(resolvedSetup);\n\n  app.use(routes);\n\n  app.use(routeNotFoundHandler);\n  app.use(errorHandler);\n\n  return app;\n};\n\nexport const startApp = (app: $Application): ?Server =>\n  app.listen(config.port, () => {\n    info(`The server is now running on port ${config.port}`);\n  });\n"]}